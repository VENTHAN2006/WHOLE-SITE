{% extends "layout.html" %}

{% block title %} - Dashboard{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="page-header">
        <h1>Agent Dashboard</h1>
        <p class="lead">Customer service AI assistant will help you provide personalized experiences</p>
    </div>

    <div class="row stats-cards">
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h5 class="card-title">Customers</h5>
                    <h2 class="stat-value">{{ customers|length }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="stat-icon">
                        <i class="fas fa-comment-dots"></i>
                    </div>
                    <h5 class="card-title">Today's Interactions</h5>
                    <h2 class="stat-value">12</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="stat-icon">
                        <i class="fas fa-box"></i>
                    </div>
                    <h5 class="card-title">Products</h5>
                    <h2 class="stat-value">{{ products|length }}</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="stat-icon">
                        <i class="fas fa-gift"></i>
                    </div>
                    <h5 class="card-title">Active Promotions</h5>
                    <h2 class="stat-value">{{ promotions|length }}</h2>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-8">
            <div class="card customer-list-card">
                <div class="card-header">
                    <h5 class="card-title">Recent Customers</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for customer in customers %}
                                <tr>
                                    <td>{{ customer.full_name }}</td>
                                    <td>{{ customer.email }}</td>
                                    <td>{{ customer.phone }}</td>
                                    <td>
                                        <a href="{{ url_for('customer_profile', customer_id=customer.id) }}" class="btn btn-sm btn-primary">
                                            <i class="fas fa-user me-1"></i> View
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card ai-assistant-card">
                <div class="card-header">
                    <h5 class="card-title">AI Assistant</h5>
                </div>
                <div class="card-body">
                    <div class="ai-assistant-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="ai-assistant-status">
                        <span class="badge bg-success">Active</span>
                    </div>
                    <h4 class="ai-assistant-name">CustServ AI</h4>
                    <p class="ai-assistant-description">
                        I'm here to help you provide personalized customer experiences. I can analyze customer data, suggest relevant products, and help build customer loyalty.
                    </p>
                    <div class="ai-assistant-actions">
                        <button class="btn btn-primary" id="openAiChat">
                            <i class="fas fa-comments me-1"></i> Ask AI Assistant
                        </button>
                    </div>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header">
                    <h5 class="card-title">Active Promotions</h5>
                </div>
                <div class="card-body">
                    <ul class="promotion-list">
                        {% for promotion in promotions %}
                        <li class="promotion-item">
                            <div class="promotion-details">
                                <h6>{{ promotion.name }}</h6>
                                <p>{{ promotion.description }}</p>
                                <span class="badge bg-info">{{ promotion.discount_percentage }}% Off</span>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">Service Representative Images</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card rep-card">
                                <img src="https://pixabay.com/get/g4036876e94188e0eebaf17eb0ecf13dd5c7d2ca20f5aad82031a81a0d9f4af74ea82dcea26a0c8d1ce99332ba18f193720a281658a50d65ce32d8da3159ae27e_1280.jpg" class="card-img-top" alt="Customer Service Representative">
                                <div class="card-body">
                                    <h5 class="card-title">Support Agent</h5>
                                    <p class="card-text">Dedicated customer service professionals ready to assist.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card rep-card">
                                <img src="https://pixabay.com/get/g16d9957171bbaeae21a94fe62763145269db3fe31009630929ba003bcd4956eb5f9c4f7766c6c9c7b5e919bfa7e562ee8c823fed77c4de2cb4f8637109b93110_1280.jpg" class="card-img-top" alt="Customer Service Representative">
                                <div class="card-body">
                                    <h5 class="card-title">Sales Consultant</h5>
                                    <p class="card-text">Expert product knowledge and personalized recommendations.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card rep-card">
                                <img src="https://pixabay.com/get/gc00ff2b1cb853ea60bfac10414feee15ff292794fa577a4080fe53d8fa13c8c3e33d7ae9e2c81fc05b43f17a34315936b29e98bd029ad51bc403c6d25dcf4400_1280.jpg" class="card-img-top" alt="Customer Service Representative">
                                <div class="card-body">
                                    <h5 class="card-title">Technical Support</h5>
                                    <p class="card-text">Solving complex issues with a friendly approach.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card rep-card">
                                <img src="https://pixabay.com/get/gee8b44b3e4c54d409d77a24fc10b937316c88efc4491aa590ff931d012c9cc524741d2cd9019d158a71d7b927a2acea0cc514331f4a50ace4ac9464c38cc74e2_1280.jpg" class="card-img-top" alt="Customer Service Representative">
                                <div class="card-body">
                                    <h5 class="card-title">Customer Success</h5>
                                    <p class="card-text">Building relationships for long-term customer satisfaction.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- AI Chat Modal -->
<div class="modal fade" id="aiChatModal" tabindex="-1" aria-labelledby="aiChatModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="aiChatModalLabel">
                    <i class="fas fa-robot me-2"></i> CustServ AI Assistant
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="chat-container" id="chatContainer">
                    <div class="chat-message ai">
                        <div class="chat-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="chat-bubble">
                            Hello! I'm CustServ AI. How can I help you provide better customer service today?
                        </div>
                    </div>
                    <div id="chatMessages"></div>
                </div>
                <div class="chat-input-container">
                    <input type="text" id="userMessage" class="form-control" placeholder="Type your question here...">
                    <button id="sendMessage" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // AI Chat Modal
    const openAiChat = document.getElementById('openAiChat');
    const aiChatModal = new bootstrap.Modal(document.getElementById('aiChatModal'));
    const sendMessageBtn = document.getElementById('sendMessage');
    const userMessageInput = document.getElementById('userMessage');
    const chatMessages = document.getElementById('chatMessages');
    
    if (openAiChat) {
        openAiChat.addEventListener('click', function() {
            aiChatModal.show();
        });
    }
    
    if (sendMessageBtn && userMessageInput) {
        sendMessageBtn.addEventListener('click', sendUserMessage);
        userMessageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendUserMessage();
            }
        });
    }
    
    function sendUserMessage() {
        const message = userMessageInput.value.trim();
        if (message === '') return;
        
        // Add user message to chat
        const userMsg = `
        <div class="chat-message user">
            <div class="chat-bubble">
                ${message}
            </div>
            <div class="chat-avatar">
                <i class="fas fa-user"></i>
            </div>
        </div>
        `;
        chatMessages.innerHTML += userMsg;
        userMessageInput.value = '';
        
        // Simulate AI response (would connect to backend in production)
        setTimeout(() => {
            let aiResponse;
            if (message.toLowerCase().includes('recommendation') || message.toLowerCase().includes('suggest')) {
                aiResponse = "Based on customer data analysis, I recommend focusing on our Premium Account and Security Package for high-value customers. For new customers, the Basic Plan with Mobile Add-on is showing excellent conversion rates.";
            } else if (message.toLowerCase().includes('customer') || message.toLowerCase().includes('data')) {
                aiResponse = "Customer data shows that product preferences vary by demographic. Customers aged 25-34 prefer our mobile services, while business customers prioritize security features. Would you like specific insights for a particular customer segment?";
            } else if (message.toLowerCase().includes('promotion') || message.toLowerCase().includes('discount')) {
                aiResponse = "Our current Summer Discount promotion is performing well with a 15% conversion rate. The New Customer discount has been most effective for first-time buyers. I recommend highlighting these when speaking with appropriate customers.";
            } else {
                aiResponse = "I can help you analyze customer data, suggest personalized products, and provide insights on customer preferences. Is there a specific area you'd like assistance with?";
            }
            
            const aiMsg = `
            <div class="chat-message ai">
                <div class="chat-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="chat-bubble">
                    ${aiResponse}
                </div>
            </div>
            `;
            chatMessages.innerHTML += aiMsg;
            
            // Scroll to bottom of chat
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }, 1000);
        
        // Scroll to bottom of chat
        const chatContainer = document.getElementById('chatContainer');
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }
});
</script>
{% endblock %}
